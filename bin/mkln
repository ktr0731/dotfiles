#!/bin/zsh

DOTPATH=$HOME/dotfiles

echo "\$DOTPATH : $DOTPATH"
echo "Created dotfile symbolic links."

directories=(zsh vim git others)

for dir in ${directories[@]}; do
  echo "$dir"

  for rcfile in "$DOTPATH"/"$dir"/*; do
    ln -sf "$rcfile" "$HOME/.${rcfile:t}"
    if [ $? -eq 0 ]; then
      print "    - $rcfile"
    fi
  done

  # Neovim
  if [ "$dir" = vim ]; then
    ln -sf "$DOTPATH"/"$dir"/vim "$HOME"/.config/nvim
    if [ $? -eq 0 ]; then
      print "    - nvim (Neovim)"
    fi

    ln -sf "$DOTPATH"/"$dir"/vimrc "$HOME"/.config/nvim/init.vim
    if [ $? -eq 0 ]; then
      print "    - init.vim (Neovim)"
    fi
  fi

  echo ""
done

# Zim
setopt EXTENDED_GLOB
for template_file ( ${ZDOTDIR:-${HOME}}/.zim/templates/* ); do
  user_file="${ZDOTDIR:-${HOME}}/.${template_file:t}"
  touch ${user_file}
  ( print -rn "$(<${template_file})$(<${user_file})" >! ${user_file} ) 2>/dev/null
done
